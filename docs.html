<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Документи - Калькулятор норми робочого часу</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="styles-drawings.css">
    <script src="main.js" type="module"></script>
</head>
<body>
    <div id="iif-modal-overlay" class="modal-overlay">
        <div id="iif-table-modal" class="modal-window">
            <span id="modal-close-button" class="close-button">&times;</span>
            <h2 class="table-title">Індекс споживчих цін (індекс інфляції)</h2>
            <div id="iif-table-wrapper">
                </div>
        </div>
        <div id="iif-chart-modal" class="modal-window chart-window">
             <div id="iif-chart-container">
                </div>
        </div>
    </div>

    <div id="nyan-cat-container" style="display: none;"></div>

    <main class="main-content">
        <div class="theme-switcher-container">
            <label>Тема:</label>
            <div class="theme-select-wrapper">
                <div id="theme-button" class="theme-button" tabindex="0">
                    <span class="theme-text"></span>
                </div>
                <div id="theme-dropdown" class="theme-dropdown">
                    <div class="theme-option" data-value="light">Світла</div>
                    <div class="theme-option" data-value="pastel-pink">Світла (рожева)</div>
                    <div class="theme-option" data-value="dark">Темна</div>
                    <div class="theme-option" data-value="dark-purple">Темна (фіолетова)</div>
                    <div class="theme-option" data-value="dark-bordeaux">Темна (червона)</div>
                    <div class="theme-option" data-value="dark-green">Темна (зелена)</div>
                </div>
            </div>
        </div>

       <div id="flyout-system" class="flyout-system">
           <div id="flyout-nav" class="flyout-nav">
               <div class="flyout-nav-content">
                    <a href="index.html" class="nav-option">Головна</a>
                    <a href="calculator.html" class="nav-option">Калькулятор</a>
                </div>
           </div>
                <div id="flyout-toggle-btn" class="flyout-toggle-btn">
                    <span class="arrow"></span>
            </div>
       </div>

        <div class="container">
            <div class="title-container">
                <h1>Документи</h1>
            </div>

            <div class="docs-controls">
                <label for="year-select">Рік:</label>
                <select id="year-select">
                    <option value="all">Всі роки</option>
                    </select>
            </div>

            <div id="docs-grid">
                </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <a href="terms.html">Умови користування</a>
            <span class="footer-separator">|</span>
            <a href="privacy.html">Політика конфіденційності</a>
            <span class="footer-separator">|</span>
            <p>Контактна інформація: <a href="mailto:pogdestiny+worktimecalculator@gmail.com" id="contact-email">pogdestiny+worktimecalculator@gmail.com</a><span id="copy-notification"></span></p>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modalOverlay = document.getElementById('iif-modal-overlay');
            const tableModal = document.getElementById('iif-table-modal');
            const chartModal = document.getElementById('iif-chart-modal');
            const tableWrapper = document.getElementById('iif-table-wrapper');
            const chartContainer = document.getElementById('iif-chart-container');
            const closeButton = document.getElementById('modal-close-button');

            let iifData = null;
            let currentYear = null;
            let isTransitionLocked = false;
            let tableElement = null;

            const createIifTable = async () => {
                try {
                    const response = await fetch('iif_data.json');
                    iifData = await response.json();

                    tableElement = document.createElement('table');
                    tableElement.className = 'iif-table';
                    const thead = document.createElement('thead');
                    const tbody = document.createElement('tbody');
                    const headerRow = document.createElement('tr');
                    const yearHeader = document.createElement('th');
                    yearHeader.textContent = 'Рік';
                    headerRow.appendChild(yearHeader);
                    ['Січ', 'Лют', 'Бер', 'Кві', 'Тра', 'Чер', 'Лип', 'Сер', 'Вер', 'Жов', 'Лис', 'Гру', 'Всього'].forEach(month => {
                        const th = document.createElement('th');
                        th.textContent = month;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    tableElement.appendChild(thead);
                    const sortedYears = Object.keys(iifData).sort((a, b) => b - a);
                    sortedYears.forEach(year => {
                        const row = document.createElement('tr');
                        const yearCell = document.createElement('td');
                        yearCell.textContent = year;
                        yearCell.dataset.year = year;
                        yearCell.classList.add('year-cell');
                        row.appendChild(yearCell);
                        iifData[year].forEach(value => {
                            const cell = document.createElement('td');
                            cell.textContent = value !== null ? value : '-';
                            row.appendChild(cell);
                        });
                        tbody.appendChild(row);
                    });
                    tableElement.appendChild(tbody);
                    tableWrapper.appendChild(tableElement);
                } catch (error) {
                    console.error('Не вдалося завантажити дані інфляції:', error);
                    tableWrapper.innerHTML = '<p>Помилка завантаження даних.</p>';
                }
            };

            const createChart = (year) => {
                const yearData = iifData[year].slice(0, 12);
                const months = ['Січ', 'Лют', 'Бер', 'Кві', 'Тра', 'Чер', 'Лип', 'Сер', 'Вер', 'Жов', 'Лис', 'Гру'];

                chartContainer.innerHTML = '';

                const chartWrapper = document.createElement('div');
                chartWrapper.className = 'chart-wrapper';

                const svgNS = "http://www.w3.org/2000/svg";
                const svg = document.createElementNS(svgNS, "svg");
                svg.setAttribute('class', 'line-chart');
                svg.setAttribute('viewBox', '0 0 550 280'); // Збільшено висоту
                svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');

                const validData = yearData.filter(v => v !== null);
                const dataMax = Math.max(...validData, 101);
                const dataMin = Math.min(...validData, 99);

                const verticalPadding = Math.max(7, (dataMax - dataMin) * 0.5);
                const viewMax = dataMax + verticalPadding;
                const viewMin = dataMin - verticalPadding;
                const range = viewMax - viewMin;

                const y = (val) => 240 - ((val - viewMin) / range * 210);
                const xStep = 480 / 12;
                const x = (index) => 40 + (index * xStep) + (xStep / 2);

                const yAxis = document.createElementNS(svgNS, 'line');
                yAxis.setAttribute('class', 'axis-line');
                yAxis.setAttribute('x1', 40);
                yAxis.setAttribute('y1', 20);
                yAxis.setAttribute('x2', 40);
                yAxis.setAttribute('y2', 215); // Обрізано
                svg.appendChild(yAxis);

                if (100 >= viewMin && 100 <= viewMax) {
                    const baselineY = y(100);
                    const baseline = document.createElementNS(svgNS, 'line');
                    baseline.setAttribute('class', 'baseline');
                    baseline.setAttribute('x1', 40);
                    baseline.setAttribute('y1', baselineY);
                    baseline.setAttribute('x2', 520);
                    baseline.setAttribute('y2', baselineY);
                    svg.appendChild(baseline);
                    const baselineLabel = document.createElementNS(svgNS, 'text');
                    baselineLabel.setAttribute('class', 'axis-label');
                    baselineLabel.setAttribute('x', 35);
                    baselineLabel.setAttribute('y', baselineY + 5);
                    baselineLabel.textContent = '100';
                    svg.appendChild(baselineLabel);
                }

                const points = yearData.map((val, i) => val !== null ? `${x(i)},${y(val)}` : null).filter(Boolean);

                if (points.length > 1) {
                    const polyline = document.createElementNS(svgNS, 'polyline');
                    polyline.setAttribute('class', 'chart-line');
                    polyline.setAttribute('points', points.join(' '));
                    svg.appendChild(polyline);
                }

                yearData.forEach((val, i) => {
                    if (val === null) return;
                    const pointY = y(val);

                    const circle = document.createElementNS(svgNS, 'circle');
                    circle.setAttribute('class', `chart-point ${val >= 100 ? 'positive' : 'negative'}`);
                    circle.setAttribute('cx', x(i));
                    circle.setAttribute('cy', pointY);
                    circle.setAttribute('r', 4);

                    const title = document.createElementNS(svgNS, 'title');
                    title.textContent = `${months[i]}: ${val}`;
                    circle.appendChild(title);
                    svg.appendChild(circle);

                    const pointLabel = document.createElementNS(svgNS, 'text');
                    pointLabel.setAttribute('class', 'point-label');
                    pointLabel.setAttribute('x', x(i));
                    pointLabel.setAttribute('y', pointY - 12);
                    pointLabel.textContent = val;
                    svg.appendChild(pointLabel);
                });

                months.forEach((month, i) => {
                    const label = document.createElementNS(svgNS, 'text');
                    label.setAttribute('class', 'month-label');
                    label.setAttribute('x', x(i));
                    label.setAttribute('y', 230); // Позиція біля умовного "90"
                    svg.appendChild(label);
                });

                const chartTitle = document.createElement('div');
                chartTitle.className = 'chart-title';
                chartTitle.textContent = `Індекс інфляції за ${year} рік`;

                chartWrapper.appendChild(svg);
                chartWrapper.appendChild(chartTitle);
                chartContainer.appendChild(chartWrapper);
            };

            const handleYearClick = (year) => {
                if (isTransitionLocked) return;

                document.querySelectorAll('.year-cell.active').forEach(cell => cell.classList.remove('active'));

                if (currentYear === year) {
                    modalOverlay.classList.remove('chart-view-active');
                    tableModal.appendChild(closeButton);
                    currentYear = null;
                } else {
                    if (currentYear !== null) {
                        isTransitionLocked = true;
                        setTimeout(() => { isTransitionLocked = false; }, 200); // Затримка 0.2с
                    }

                    document.querySelector(`.year-cell[data-year="${year}"]`).classList.add('active');
                    createChart(year);
                    currentYear = year;
                    modalOverlay.classList.add('chart-view-active');
                    chartModal.appendChild(closeButton);
                }
            };

            const openModal = async () => {
                if (!tableElement) {
                    await createIifTable();
                }
                modalOverlay.classList.add('visible');
            };

            const closeModal = () => {
                modalOverlay.classList.remove('visible');
                modalOverlay.classList.remove('chart-view-active');
                currentYear = null;
                tableModal.appendChild(closeButton);
                document.querySelectorAll('.year-cell.active').forEach(cell => cell.classList.remove('active'));
            };

            document.getElementById('docs-grid').addEventListener('click', (event) => {
                const featureBlock = event.target.closest('a.feature-block');
                if (featureBlock && featureBlock.getAttribute('href') === '#iif-container') {
                    event.preventDefault();
                    openModal();
                }
            });

            tableWrapper.addEventListener('click', (event) => {
                if (event.target.classList.contains('year-cell')) {
                    handleYearClick(event.target.dataset.year);
                }
            });

            closeButton.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>